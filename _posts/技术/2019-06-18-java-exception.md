---
layout: post
title: Java 编程思想学习笔记-异常
category: 技术
---
## 12.2 基本异常

异常情形是指阻止当前方法或作用域继续执行的问题。
异常是的我们可以将每件事情都当成一个事务来考虑，而异常可以看护这些事务的底线。我们还可以将异常看成一种内建的恢复系统。如果程序某部分失败了，异常将恢复到程序中某个已知的稳定点。

### 12.2.1 异常参数

能够抛出任意类型的Throwable对象，它是异常类型的根类。通常，对于不同类型的错误，要抛出相应的异常。

## 12.3 捕获异常

监控区域是一段可能产生异常的代码，后面跟着处理这些异常的代码。

## 12.3.1 try 块

方法抛出异常，如果不希望方法结束，可以在方法内设置一个特殊的块来捕获异常，这个块称为try块。有了异常处理机制，可以把所有动作都放在try块里，然后只需要一个地方就可以捕获所有异常。
这意味着代码更容易编写和阅读，因为代码没有混在一起。

## 12.3.2 异常处理程序

异常处理程序必须紧跟在catch之后。只有匹配的catch字句才能得到执行。许多不同的调用可能产生相同的异常，但只需要一个针对此类型异常的处理程序。

异常处理理论有两种基本类型。Java支持终止模型，假设错误非常关键，以至于程序无法返回到异常发生的地方继续执行。另一种是恢复模型，修复错误，重新尝试调用出问题的方法。Java如果要实现类型恢复的行为，那么就不能抛出异常，而是调用方法来修正。或者try块放入循环中。

恢复模型开始显得非常吸引人，但是不实用。主要的原因是其导致的耦合：恢复性的处理程序需要了解异常抛出的地点，这必然需要包含依赖于抛出位置的非通用型代码。增加了代码编写和维护的困难。

## 12.4 创建自定义异常

定义自定义异常类，从已有的异常类继承，最好选择意思相近的异常类继承。

### 12.4.1 异常与记录日志

可以将日志的记录过程放在异常中，但是更多的情形是，异常处理生成日志消息，根据捕获的异常和额外信息。
可以加入额外的成员和构造器进一步的自定义异常。

## 12.5 异常说明

Java强制使用异常说明的语法，来告知客户端程序员某个方法可能抛出的异常类型。异常说明属于方法声明的一部分，紧跟在形参后面，throws后面跟所有可能抛出异常的列表。

## 12.6 捕获所有的异常

可以只写一个异常处理程序来捕获所有的异常，那就是补充异常类型的基类Exception。一般把这个处理程序放在末尾，以防其他捕获之前，已经被捕获了。

### 12.6.1 栈轨迹

getStackTrace返回一个栈轨迹元素构成的数组，栈顶是最后一个调用，栈底是第一个调用。

### 12.6.2 重新抛出异常

重抛异常会把异常抛给上一级的处理程序，同一个try块的其他异常处理程序将被跳过。
如果只是重抛异常，调用栈信息依旧是原异常抛出点。如果要更新这个信息，可以使用fillInStackTrace方法，它可以将当前的调用信息，替换原本的异常对象堆栈。
抛出新的异常，和fillInStackTrace效果相同，捕获程序仅知道新异常发生的堆栈。

### 12.6.3 异常链

常常在捕获异常后抛出另一个异常，并且希望把原始异常的信息保存下来，这称为异常链。
现在所有的Throwable的子类可以接收一个cause对象作为参数，这个cause就是原始异常。
在Throwable的子类，有三种子类提供了cause的构造对象，分别是Error,Exception和RuntimeException,其他需要通过initCause方法，而不是构造器。
